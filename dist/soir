#!/usr/bin/env just --justfile

BASE_DIR := "$HOME"
SOIR_DIR := BASE_DIR + "/.soir"
SOIR_BIN_DIR := SOIR_DIR + "/bin"

_default:
    @just --list --unsorted --justfile {{ justfile() }}

# Initializes the soir environment to the latest released version.
[group('setup')]
setup:
    #!/usr/bin/env bash
    TAG=$(curl -s "https://api.github.com/repos/aimxhaisse/soir/releases/latest" | jq -r .tag_name)
    RELEASE="soir-${TAG}-{{ arch() }}-{{ os() }}"

    echo "$RELEASE"
    
    exit

    function install_script {
        echo "Updating soir command-line to ${TAG}"
        curl -L "https://github.com/aimxhaisse/soir/tree/${TAG}/dist/soir" -o "${SOIR_BIN_DIR}/soir"
        chmod +x "${SOIR_BIN_DIR}/soir"
    }

    function install_binary {
        echo "Updating soir engine to ${TAG}"
        curl -L "https://github.com/aimxhaisse/soir/releases/download/${TAG}/${RELEASE}" -o "${SOIR_BIN_DIR}/soir-engine"
    }

    install_script
    install_binary

# Check if dependencies are installed.
[group('setup')]
check-deps:
    #!/usr/bin/env bash
    function check-dep {
        if ! command -v $1 &> /dev/null; then
            echo "Please install $1"
        fi
    }

    check-dep "jq"
    check-dep "curl"
    check-dep "git"
    check-dep "python3.11"
    check-dep "poetry"

# Creates a new soir session.
[group('session')]
new:
    #!/usr/bin/env bash
    echo "..."
